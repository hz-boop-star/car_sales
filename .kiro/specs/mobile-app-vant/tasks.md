# 实现计划：汽车销售系统移动端改造

## 概述

本实现计划将现有的 Element UI 桌面端应用改造为基于 Vant UI 的移动端应用。采用增量开发方式，优先实现核心功能，确保每个步骤都能独立验证。

## 任务列表

### 1. 项目初始化和依赖配置 ✅

- [x] 1.1 安装 Vant UI 依赖
  - 安装 `vant@4.x` 和相关插件
  - 配置 Vant 按需引入（使用 `unplugin-vue-components`）
  - 配置 `postcss-pxtorem` 实现移动端适配
  - _需求: 8.1, 8.2, 8.3_

- [x] 1.2 更新 Vite 配置
  - 配置 PostCSS 插件支持 rem 转换
  - 配置路径别名
  - 配置开发服务器代理
  - _需求: 8.1, 9.1_

- [x] 1.3 更新 TypeScript 配置
  - 确保类型定义正确
  - 配置 Vant 组件类型支持
  - _需求: 9.2_

### 2. 工具层重构 ✅

- [x] 2.1 更新 HTTP 请求工具
  - 修改 `src/utils/request.ts`，将 Element Plus 的 `ElMessage` 替换为 Vant 的 `showToast`
  - 保持现有的请求/响应拦截器逻辑
  - 保持 Token 认证机制不变
  - _需求: 9.1, 9.2, 9.5, 10.3_

- [x] 2.2 创建格式化工具函数
  - 创建 `src/utils/format.ts`
  - 实现日期格式化函数
  - 实现金额格式化函数
  - 实现状态文本转换函数
  - _需求: 3.7, 5.7_

### 3. API 服务层创建 ✅

- [x] 3.1 创建认证 API 服务
  - 创建 `src/api/auth.ts`
  - 实现 login、logout、getUserInfo、getSalespersons 方法
  - 复用现有的类型定义
  - _需求: 1.1, 14.1, 14.5_

- [x] 3.2 创建车辆 API 服务
  - 创建 `src/api/car.ts`
  - 实现 getCarList、getCarDetail 方法
  - 定义查询参数接口
  - _需求: 3.1, 3.5, 4.1_

- [x] 3.3 创建客户 API 服务
  - 创建 `src/api/customer.ts`
  - 实现 getCustomerList、getCustomerDetail 方法
  - 定义查询参数接口
  - _需求: 11.1, 11.5, 11.6, 12.1_

- [x] 3.4 创建订单 API 服务
  - 创建 `src/api/order.ts`
  - 实现 getOrderList、getOrderDetail、createOrder 方法
  - 定义查询参数和创建请求接口
  - _需求: 5.1, 5.5, 6.1, 13.9_

- [x] 3.5 创建统计 API 服务
  - 创建 `src/api/statistics.ts`
  - 实现 getDashboard 方法
  - _需求: 2.1_

### 4. 状态管理更新 ✅

- [x] 4.1 确认用户状态管理
  - 检查现有 `src/stores/user.ts` 是否满足需求
  - 如需要则更新，保持 token 和 userInfo 管理逻辑
  - _需求: 1.2, 14.6, 14.7_

### 5. 公共组件开发 ✅

- [x] 5.1 创建底部导航栏组件
  - 创建 `src/components/TabBar.vue`
  - 使用 `van-tabbar` 和 `van-tabbar-item`
  - 配置 5 个标签：首页、车辆、客户、订单、我的
  - 实现路由跳转和高亮显示
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 15.1, 15.2, 15.3, 15.4, 15.5_

- [x] 5.2 创建空状态组件
  - 创建 `src/components/EmptyState.vue`
  - 使用 `van-empty` 组件
  - 支持自定义文案和图标
  - _需求: 10.2_

### 6. 登录页面开发 ✅

- [x] 6.1 创建登录页面
  - 创建 `src/views/login/index.vue`
  - 使用 `van-form`、`van-field`、`van-button` 组件
  - 实现表单验证（用户名和密码必填）
  - 实现登录逻辑，调用 authApi.login
  - 登录成功后存储 token 和用户信息，跳转到首页
  - 登录失败显示错误提示
  - _需求: 1.1, 1.2, 1.3, 1.5_

### 7. 路由配置 ✅

- [x] 7.1 创建路由配置文件
  - 创建 `src/router/index.ts`
  - 配置所有页面路由（登录、首页、车辆、客户、订单、个人中心）
  - 实现路由守卫，检查登录状态
  - 未登录用户重定向到登录页
  - 已登录用户访问登录页重定向到首页
  - _需求: 1.4_

- [x] 7.2 补充完整路由配置
  - 添加车辆列表、车辆详情路由
  - 添加客户列表、客户详情路由
  - 添加订单列表、订单详情、订单创建路由
  - 添加个人中心路由
  - 配置路由 meta 信息（showTabBar）
  - _需求: 3.1, 4.1, 11.1, 12.1, 5.1, 6.1, 13.1, 14.1_

### 8. 首页开发 ✅

- [x] 8.1 创建首页
  - 创建 `src/views/home/index.vue`
  - 使用 `van-grid` 展示统计数据卡片
  - 使用 `van-pull-refresh` 实现下拉刷新
  - 调用 statisticsApi.getDashboard 获取数据
  - 显示总车辆数、可售车辆数、已售车辆数、总收入
  - 实现加载状态和错误处理
  - _需求: 2.1, 2.2, 2.3, 2.4_

### 9. 车辆管理功能开发 ✅

- [x] 9.1 创建车辆列表页
  - 创建 `src/views/car/list.vue`
  - 使用 `van-list` 实现分页加载
  - 使用 `van-pull-refresh` 实现下拉刷新
  - 使用 `van-card` 展示车辆信息
  - 显示品牌、型号、价格、状态等关键信息
  - 实现点击跳转到详情页
  - _需求: 3.1, 3.2, 3.3, 3.6, 3.7, 3.8_

- [x] 9.2 实现车辆搜索功能
  - 在车辆列表页添加搜索按钮
  - 点击显示搜索表单（使用 `van-popup` 和 `van-form`）
  - 支持品牌、状态、价格区间筛选
  - 提交搜索后重新加载列表
  - _需求: 3.4, 3.5_

- [x] 9.3 创建车辆详情页
  - 创建 `src/views/car/detail.vue`
  - 使用 `van-cell-group` 展示车辆详细信息
  - 显示 VIN 码、品牌、型号、颜色、年份、价格、状态、采购日期
  - 使用 `van-tag` 显示状态标签
  - 实现返回按钮
  - _需求: 4.1, 4.2, 4.3, 4.4_

### 10. 客户管理功能开发 ✅

- [x] 10.1 创建客户列表页
  - 创建 `src/views/customer/list.vue`
  - 使用 `van-list` 实现分页加载
  - 使用 `van-pull-refresh` 实现下拉刷新
  - 使用 `van-cell` 展示客户信息
  - 显示姓名、手机号、身份证号等关键信息
  - 实现点击跳转到详情页
  - _需求: 11.1, 11.2, 11.3, 11.7, 11.8, 11.9_

- [x] 10.2 实现客户搜索功能
  - 在客户列表页添加搜索按钮
  - 点击显示搜索表单（使用 `van-popup` 和 `van-form`）
  - 支持姓名模糊搜索和手机号精确搜索
  - 提交搜索后重新加载列表
  - _需求: 11.4, 11.5, 11.6_

- [x] 10.3 创建客户详情页
  - 创建 `src/views/customer/detail.vue`
  - 使用 `van-cell-group` 展示客户详细信息
  - 显示姓名、手机号、身份证号、性别、地址
  - 手机号使用 `<a href="tel:">` 实现点击拨号
  - 实现返回按钮
  - _需求: 12.1, 12.2, 12.3, 12.4, 12.5_

### 11. 订单管理功能开发 ✅

- [x] 11.1 创建订单列表页
  - 创建 `src/views/order/list.vue`
  - 使用 `van-list` 实现分页加载
  - 使用 `van-pull-refresh` 实现下拉刷新
  - 使用 `van-card` 展示订单信息
  - 显示订单号、客户姓名、车辆信息、成交价、订单日期
  - 实现点击跳转到详情页
  - 添加创建订单按钮（浮动按钮）
  - _需求: 5.1, 5.2, 5.3, 5.6, 5.7, 5.8_

- [x] 11.2 实现订单搜索功能
  - 在订单列表页添加搜索按钮
  - 点击显示搜索表单（使用 `van-popup` 和 `van-form`）
  - 支持日期范围、销售员、状态筛选
  - 使用 `van-datetime-picker` 选择日期
  - 使用 `van-picker` 选择销售员和状态
  - 提交搜索后重新加载列表
  - _需求: 5.4, 5.5_

- [x] 11.3 创建订单详情页
  - 创建 `src/views/order/detail.vue`
  - 使用 `van-cell-group` 展示订单详细信息
  - 显示订单号、客户信息、车辆信息、价格信息、销售员、状态、备注
  - 使用 `van-tag` 显示状态标签
  - 实现返回按钮
  - _需求: 6.1, 6.2, 6.3, 6.4_

- [x] 11.4 创建订单创建页
  - 创建 `src/views/order/create.vue`
  - 使用 `van-form` 创建表单
  - 实现客户选择（使用 `van-popup` + `van-search` + `van-list`）
  - 实现车辆选择（仅显示在库状态，使用 `van-popup` + `van-search` + `van-list`）
  - 选择车辆后自动填充原价
  - 输入优惠金额，自动计算成交价
  - 使用 `van-datetime-picker` 选择订单日期（默认当天）
  - 输入备注信息
  - 实现表单验证
  - 提交订单，成功后跳转到订单列表
  - _需求: 13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7, 13.8, 13.9, 13.10, 13.11, 13.12_

### 12. 个人中心开发 ✅

- [x] 12.1 创建个人中心页面
  - 创建 `src/views/profile/index.vue`
  - 调用 authApi.getUserInfo 获取用户信息
  - 使用 `van-cell-group` 展示用户信息
  - 显示用户名、真实姓名、角色、手机号、邮箱
  - 使用 `van-tag` 显示角色标识（管理员/销售员）
  - 手机号使用 `<a href="tel:">` 实现点击拨号
  - 添加退出登录按钮
  - _需求: 14.1, 14.2, 14.3, 14.4, 14.10_

- [x] 12.2 实现退出登录功能
  - 点击退出登录按钮显示确认对话框（使用 `van-dialog`）
  - 确认后调用 authApi.logout
  - 清除本地存储的 token 和用户信息
  - 跳转到登录页
  - _需求: 14.5, 14.6, 14.7, 14.8, 14.9_

### 13. App 主框架集成 ✅

- [x] 13.1 更新 App.vue
  - 集成 `<router-view>` 和 `<TabBar>` 组件
  - 根据路由 meta 信息控制 TabBar 显示/隐藏
  - 配置全局样式
  - _需求: 7.1, 15.1_

- [x] 13.2 更新 main.ts
  - 导入 Vant 样式
  - 配置 Vant 全局组件
  - 初始化 Pinia 和 Router
  - _需求: 8.1_

### 14. 样式和响应式优化 ✅

- [x] 14.1 配置全局样式
  - 创建 `src/styles/variables.css` 定义颜色变量
  - 创建 `src/styles/common.css` 定义通用样式
  - 确保所有页面适配移动端
  - 移除 PostCSS pxtorem 转换，使用原生 px 单位
  - 增大所有组件的字体和间距
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 14.2 测试不同屏幕尺寸
  - 在不同尺寸设备上测试（320px - 414px 宽度）
  - 测试横屏和竖屏切换
  - 确保没有横向滚动条
  - _需求: 8.1, 8.2, 8.4, 8.5_

### 15. 错误处理和加载状态完善

- [ ] 15.1 完善所有页面的加载状态
  - 使用 `van-loading` 显示加载中
  - 使用 `van-empty` 显示空数据状态
  - 确保所有 API 调用都有加载提示
  - _需求: 10.1, 10.2_

- [ ] 15.2 完善所有页面的错误处理
  - 网络错误显示友好提示
  - 提供重试按钮
  - 确保错误不会导致应用崩溃
  - _需求: 10.3, 10.4, 10.5_

### 16. Checkpoint - 功能验证

- [ ] 16.1 完整功能测试
  - 测试登录流程
  - 测试所有列表页的加载、刷新、搜索功能
  - 测试所有详情页的显示
  - 测试订单创建流程
  - 测试个人中心和退出登录
  - 测试底部导航栏切换
  - 确保所有功能正常工作，如有问题请告知用户

### 17. Capacitor 配置和打包 ✅

- [x] 17.1 配置 Capacitor
  - 更新 `capacitor.config.ts`
  - 配置生产环境 API 地址
  - 配置 Android 相关设置
  - _需求: 9.1_

- [ ] 17.2 配置生产环境变量
  - 创建 `.env.production` 文件
  - 配置生产环境 API 地址
  - _需求: 9.1_

- [ ] 17.3 构建和同步
  - 执行 `pnpm build` 构建生产版本
  - 执行 `pnpm cap:sync` 同步到 Capacitor
  - 在 Android Studio 中测试 APK
  - _需求: 8.1_

### 18. 最终验证

- [ ] 18.1 在真实设备上测试
  - 在 Android 设备上安装 APK
  - 测试所有功能
  - 测试网络请求
  - 测试性能和流畅度
  - 确保所有功能正常，如有问题请告知用户

## 注意事项

1. **增量开发**：每个任务完成后都应该能够独立验证
2. **API 复用**：完全使用现有后端 API，不需要后端改动
3. **类型安全**：充分利用 TypeScript 类型检查
4. **移动端优化**：注重下拉刷新、上拉加载等移动端交互
5. **错误处理**：每个 API 调用都要有完善的错误处理
6. **用户体验**：加载状态、空状态、错误状态都要有友好的提示

## 技术栈

- Vue 3 + TypeScript + Composition API
- Vant 4.x
- Pinia
- Vue Router 4
- Axios
- Vite
- Capacitor 8.x
