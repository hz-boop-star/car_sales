# 实现计划：汽车销售管理系统

## 概述

本实现计划将汽车销售管理系统的开发分为三个主要阶段：数据库设计与实施、后端开发、前端开发。每个阶段包含具体的编码任务，按照增量方式构建系统功能。所有任务都基于需求文档和设计文档，确保实现符合课程设计要求。

## 任务列表

### 阶段 1：数据库设计与实施

- [x] 1. 创建数据库初始化脚本
  - 编写完整的 SQL DDL 脚本，包含所有表、视图、存储过程、索引
  - 使用 openGauss/PostgreSQL 兼容语法
  - 确保所有主键使用 BIGINT 类型（为雪花算法预留）
  - 配置所有外键约束、唯一约束、检查约束
  - _需求：7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 9.2, 9.3, 9.4, 9.5_

- [x] 1.1 创建核心表结构
  - 创建 sys_user 表（用户表）
  - 创建 car_info 表（车辆信息表）
  - 创建 customer 表（客户表）
  - 创建 sales_order 表（销售订单表）
  - 添加所有约束（NOT NULL、UNIQUE、CHECK、FOREIGN KEY）
  - _需求：2.1, 2.2, 3.1, 3.3, 3.4, 4.2, 7.3, 9.2, 9.3, 9.4, 9.5_

- [x] 1.2 创建索引
  - 为 car_info 表创建索引（vin, brand, status, price）
  - 为 customer 表创建索引（phone, name）
  - 为 sales_order 表创建索引（sales_user_id, customer_id, car_id, order_date, order_no）
  - 为 sys_user 表创建索引（username）
  - _需求：7.6_

- [x] 1.3 创建销售统计视图
  - 创建 v_sales_statistics 视图（按品牌、型号、销售员统计）
  - 创建 v_monthly_sales_trend 视图（月度销售趋势）
  - _需求：6.2, 6.7, 7.4_

- [x] 1.4 创建订单创建存储过程
  - 实现 proc_create_order 存储过程
  - 包含车辆状态检查、订单创建、车辆状态更新
  - 使用 FOR UPDATE 行锁防止并发问题
  - 实现完整的错误处理和事务回滚
  - _需求：4.1, 4.2, 4.3, 4.4, 4.5, 7.5, 9.1, 9.6_

- [x] 1.5 准备测试数据脚本
  - 编写插入测试数据的 SQL 脚本
  - 包含用户、车辆、客户、订单的示例数据
  - 确保数据符合所有约束条件
  - _需求：所有需求的测试数据_

### 阶段 2：后端开发（Spring Boot）

- [x] 2. 搭建 Spring Boot 项目基础架构
  - 创建 Maven/Gradle 项目结构
  - 配置 pom.xml/build.gradle 依赖
  - 配置 application.yml（数据库连接、MyBatis-Plus、日志）
  - 配置 PostgreSQL JDBC 驱动连接 openGauss
  - _需求：10.1, 10.5, 10.8_

- [x] 2.1 配置全局组件
  - 实现统一响应结果封装类 Result<T>
  - 实现全局异常处理器 GlobalExceptionHandler
  - 配置 CORS 跨域支持
  - 配置 MyBatis-Plus 雪花算法 ID 生成器
  - 配置字段自动填充（create_time, update_time）
  - _需求：7.2, 9.8, 10.2, 10.3, 10.4_


- [x] 3. 实现用户认证模块
  - 创建 SysUser 实体类（使用 @TableId(type = IdType.ASSIGN_ID)）
  - 创建 UserMapper 接口
  - 创建 UserService 实现登录、登出逻辑
  - 创建 AuthController 提供登录/登出接口
  - 实现密码加密（BCrypt）
  - 实现 JWT Token 生成和验证
  - _需求：1.1, 1.2, 1.3, 1.6_

- [ ]* 3.1 编写用户认证单元测试
  - 测试有效凭证登录成功
  - 测试无效凭证登录失败
  - 测试 Token 过期处理
  - _需求：1.1, 1.2, 1.6_

- [ ]* 3.2 编写用户认证属性测试
  - **属性 12：有效凭证认证成功**
  - **属性 13：无效凭证认证失败**
  - **属性 15：会话过期强制执行**
  - **验证需求：1.1, 1.2, 1.6**

- [x] 4. 实现车辆管理模块
  - 创建 CarInfo 实体类
  - 创建 CarMapper 接口（包含多条件查询方法）
  - 创建 CarService 实现 CRUD 和查询逻辑
  - 创建 CarController 提供 RESTful API
  - 实现品牌、价格区间、状态的组合查询
  - _需求：2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9_

- [ ]* 4.1 编写车辆管理单元测试
  - 测试车辆创建、更新、删除
  - 测试多条件查询
  - 测试已售车辆删除防护
  - _需求：2.1-2.9_

- [ ]* 4.2 编写车辆管理属性测试
  - **属性 1：雪花算法 ID 唯一性**
  - **属性 2：唯一性约束强制执行（VIN）**
  - **属性 3：数据持久化往返一致性**
  - **属性 4：车辆初始状态**
  - **属性 5：品牌过滤正确性**
  - **属性 6：价格区间过滤正确性**
  - **属性 7：状态过滤正确性**
  - **属性 8：已售车辆删除防护**
  - **验证需求：2.1-2.9, 7.2**

- [x] 5. 实现客户管理模块
  - 创建 Customer 实体类
  - 创建 CustomerMapper 接口（包含模糊查询方法）
  - 创建 CustomerService 实现 CRUD 逻辑
  - 创建 CustomerController 提供 RESTful API
  - 实现姓名模糊搜索和手机号精确搜索
  - 实现客户删除前的订单关联检查
  - _需求：3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8_

- [ ]* 5.1 编写客户管理单元测试
  - 测试客户创建、更新、删除
  - 测试姓名模糊搜索
  - 测试手机号精确搜索
  - 测试有订单客户删除防护
  - _需求：3.1-3.8_

- [ ]* 5.2 编写客户管理属性测试
  - **属性 2：唯一性约束强制执行（phone, id_card）**
  - **属性 3：数据持久化往返一致性**
  - **属性 9：客户姓名模糊搜索**
  - **属性 10：客户手机号精确搜索**
  - **属性 11：有订单客户删除防护**
  - **验证需求：3.1-3.8**

- [x] 6. 实现订单管理模块（核心）
  - 创建 SalesOrder 实体类
  - 创建 OrderMapper 接口（包含调用存储过程的方法）
  - 创建 OrderService 调用存储过程创建订单
  - 创建 OrderController 提供订单 API
  - 实现订单列表查询（支持日期、销售员、状态过滤）
  - 实现订单详情查询（包含关联的用户、客户、车辆信息）
  - _需求：4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 4.10_

- [ ]* 6.1 编写订单管理单元测试
  - 测试订单创建成功场景
  - 测试非可售车辆订单防护
  - 测试订单查询过滤
  - _需求：4.1-4.10_

- [ ]* 6.2 编写订单管理属性测试
  - **属性 16：订单创建状态转换**
  - **属性 17：订单实体关系**
  - **属性 18：非可售车辆订单防护**
  - **属性 19：订单查询日期区间过滤**
  - **属性 20：订单查询销售员过滤**
  - **属性 21：订单查询状态过滤**
  - **属性 22：订单查询关联数据**
  - **验证需求：4.3-4.10**

- [x] 7. 检查点 - 核心功能验证
  - 确保所有核心 CRUD 功能正常工作
  - 确保存储过程正确调用
  - 确保所有约束正确执行
  - 询问用户是否有问题

- [x] 8. 实现 Excel 导入导出功能
  - 添加 EasyExcel 依赖
  - 创建车辆导入 DTO 和导出 VO
  - 实现车辆批量导入逻辑（包含验证和事务处理）
  - 实现销售报表导出逻辑（包含关联数据）
  - 在 CarController 中添加导入导出接口
  - _需求：5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7_

- [ ]* 8.1 编写导入导出单元测试
  - 测试有效 Excel 文件导入
  - 测试无效数据导入失败
  - 测试导出文件生成
  - _需求：5.1-5.7_

- [ ]* 8.2 编写导入导出属性测试
  - **属性 23：Excel 导入 ID 唯一性**
  - **属性 24：Excel 导入 VIN 唯一性验证**
  - **属性 25：导入事务原子性**
  - **属性 26：Excel 导出完整性**
  - **验证需求：5.2-5.7**

- [x] 9. 实现统计报表模块
  - 创建统计相关的 VO 类
  - 创建 StatisticsMapper 接口（查询视图）
  - 创建 StatisticsService 实现统计逻辑
  - 创建 StatisticsController 提供统计 API
  - 实现品牌销量统计接口
  - 实现销售趋势统计接口
  - 实现仪表盘数据聚合接口
  - _需求：6.2, 6.7_

- [ ]* 9.1 编写统计报表单元测试
  - 测试视图查询结果
  - 测试仪表盘数据聚合
  - _需求：6.2, 6.7_

- [ ]* 9.2 编写统计报表属性测试
  - **属性 27：统计视图聚合正确性**
  - **属性 28：视图数据一致性**
  - **验证需求：6.2, 6.7**

- [x] 10. 实现权限控制
  - 创建权限拦截器或使用 Spring Security
  - 实现基于角色的访问控制（RBAC）
  - 配置管理员和销售员的权限规则
  - 在 Controller 方法上添加权限注解
  - _需求：1.3, 1.4, 1.5_

- [ ]* 10.1 编写权限控制单元测试
  - 测试管理员访问所有功能
  - 测试销售员访问限制
  - _需求：1.3, 1.4, 1.5_

- [ ]* 10.2 编写权限控制属性测试
  - **属性 14：基于角色的访问控制**
  - **验证需求：1.3, 1.4, 1.5**

- [x] 11. 实现日志记录
  - 配置 Logback 日志框架
  - 创建操作日志切面（AOP）
  - 记录关键操作（登录、订单创建、车辆状态变更）
  - 配置日志输出格式和文件滚动策略
  - _需求：9.8_

- [ ]* 11.1 编写日志记录属性测试
  - **属性 34：关键操作日志记录**
  - **验证需求：9.8**

 ·12] 12. 后端集成测试
  - 配置 testcontainers 启动 PostgreSQL 测试容器
  - 编写存储过程集成测试
  - 编写视图查询集成测试
  - 编写并发事务测试
  - _需求：4.1-4.5, 6.2, 9.6_

- [ ] 13. 检查点 - 后端完整性验证
  - 运行所有单元测试和属性测试
  - 确保测试覆盖率达标
  - 使用 Postman/Swagger 测试所有 API
  - 询问用户是否有问题

### 阶段 3：前端开发（Vue 3 + TypeScript）

 - [x] 14. 搭建 Vue 3 项目基础架构
  - 使用 Vite 创建 Vue 3 + TypeScript 项目
  - 安装依赖（Element Plus, Pinia, Vue Router, Axios, ECharts）
  - 配置 TypeScript 编译选项
  - 配置 Vite 代理解决跨域问题
  - _需求：10.2_

- [x] 14.1 配置项目基础设施
  - 创建项目目录结构（api, components, views, stores, router, utils, types）
  - 配置 Axios 请求拦截器（添加 Token）
  - 配置 Axios 响应拦截器（统一错误处理）
  - 创建 TypeScript 类型定义文件
  - _需求：10.3, 10.4_

- [ ] 15. 实现布局框架
  - 创建 Layout 组件（侧边栏 + 顶部 Header + 内容区域）
  - 创建侧边栏导航菜单
  - 创建顶部 Header（显示用户信息、登出按钮）
  - 配置路由守卫（检查登录状态）
  - _需求：8.1_

- [ ] 16. 实现登录页面
  - 创建 Login.vue 组件
  - 实现登录表单（用户名、密码）
  - 实现表单验证
  - 调用登录 API 并存储 Token
  - 登录成功后跳转到仪表盘
  - _需求：1.1, 1.2_

- [ ] 17. 实现车辆管理页面
  - 创建 CarList.vue 组件
  - 实现车辆列表表格（使用 Element Plus Table）
  - 实现多条件搜索表单（品牌、价格区间、状态）
  - 使用 Tag 显示车辆状态（不同颜色）
  - 实现分页功能
  - 实现车辆新增/编辑对话框
  - 实现车辆删除功能
  - _需求：2.5, 2.6, 2.7, 8.2_

- [ ] 17.1 实现车辆导入导出功能
  - 添加"导入 Excel"按钮和文件上传组件
  - 调用导入 API 并显示导入结果
  - 添加"导出"按钮
  - 调用导出 API 并触发文件下载
  - _需求：5.1, 5.5_

- [ ] 18. 实现客户管理页面
  - 创建 CustomerList.vue 组件
  - 实现客户列表表格
  - 实现搜索表单（姓名模糊搜索、手机号精确搜索）
  - 实现分页功能
  - 实现客户新增/编辑对话框
  - 实现客户删除功能
  - _需求：3.5, 3.6_

- [ ] 19. 实现订单管理页面
  - 创建 OrderList.vue 组件
  - 实现订单列表表格（显示关联的客户、车辆信息）
  - 实现搜索表单（日期区间、销售员、状态）
  - 实现分页功能
  - 实现订单详情查看
  - _需求：4.7, 4.8, 4.9, 4.10_

- [ ] 19.1 实现订单创建向导
  - 创建 CreateOrder.vue 组件
  - 实现步骤 1：选择客户（可搜索下拉列表）
  - 实现步骤 2：选择车辆（只显示"在库"状态的车辆）
  - 实现步骤 3：确认订单信息并提交
  - 调用订单创建 API
  - 创建成功后跳转到订单列表
  - _需求：4.1, 8.3, 8.4, 8.5_

- [ ] 20. 实现仪表盘页面
  - 创建 Dashboard.vue 组件
  - 显示统计卡片（总车辆数、可售车辆数、已售车辆数、总订单数、总收入）
  - 集成 ECharts 显示品牌销量占比饼图
  - 集成 ECharts 显示月度销售趋势折线图/柱状图
  - 调用统计 API 获取数据
  - _需求：6.4, 6.5, 6.6_

- [ ] 21. 实现 Pinia 状态管理
  - 创建 User Store（存储用户信息、Token、权限）
  - 创建 App Store（存储应用配置、侧边栏状态）
  - 实现状态持久化（localStorage）
  - _需求：1.6_

- [ ] 22. 前端组件测试
  - 配置 Vitest 和 Vue Test Utils
  - 编写登录组件测试
  - 编写车辆列表组件测试
  - 编写订单创建组件测试
  - _需求：所有前端需求_

- [ ] 23. 检查点 - 前端完整性验证
  - 测试所有页面功能
  - 测试前后端联调
  - 测试响应式布局
  - 询问用户是否有问题

### 阶段 4：系统集成与优化

- [ ] 24. 端到端测试（可选）
  - 配置 Playwright 或 Cypress
  - 编写登录到创建订单的完整流程测试
  - 编写车辆导入导出流程测试
  - _需求：所有需求_

- [ ] 25. 性能优化
  - 优化数据库查询（检查索引使用情况）
  - 优化前端加载速度（代码分割、懒加载）
  - 优化 API 响应时间
  - _需求：7.6_

- [ ] 26. 文档编写
  - 编写系统安装部署文档
  - 编写 API 接口文档（Swagger）
  - 编写用户使用手册
  - 准备课程设计报告材料
  - _需求：10.7_

- [ ] 27. 最终检查点
  - 运行所有测试（单元测试、属性测试、集成测试）
  - 验证所有课程设计要求（禁用自增、存储过程、视图、索引）
  - 准备演示数据和演示脚本
  - 准备 5 分钟系统介绍演示
  - 询问用户是否准备好提交

## 注意事项

- 标记 `*` 的任务为可选任务（主要是测试相关），可以根据时间安排决定是否实现
- 每个检查点任务都需要确保之前的所有任务都已完成并通过测试
- 属性测试需要使用 Jqwik（Java）或 fast-check（TypeScript）库
- 所有属性测试必须运行至少 100 次迭代
- 每个属性测试必须包含注释标签引用设计文档中的属性编号
