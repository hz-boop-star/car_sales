# 项目开发规范：汽车销售管理系统（课程设计版）

## 1. 项目概况
**角色**：你是一位资深全栈工程师兼系统架构师。
**目标**：设计并实现一个“汽车销售管理系统”，用于大学课程设计。
**核心挑战**：项目需要兼顾现代开发实践（Spring Boot + Vue）与传统的学院派数据库要求（必须使用存储过程、视图、非自增主键）。

## 2. 技术栈
- **后端**：Java 17+, Spring Boot 3.x, MyBatis-Plus。
- **数据库**：openGauss（协议兼容 PostgreSQL）。*注意：代码中使用 PostgreSQL JDBC 驱动。*
- **前端**：Vue 3 (Composition API), TypeScript, Element Plus, Pinia, Axios。
- **工具**：EasyExcel（用于导入导出）, Lombok, ECharts（用于数据可视化）。

## 3. 硬性数据库约束（评分关键点 - 必须严格遵守）
1.  **严禁使用自增主键**：
    - 数据库表中**禁止**使用 `AUTO_INCREMENT`。
    - **必须**在代码层面使用“雪花算法”（MyBatis-Plus 的 `IdType.ASSIGN_ID`）或 UUID 生成主键（类型为 `BIGINT` 或 `VARCHAR`）。
2.  **必须展示数据库能力**：
    - **视图 (Views)**：必须创建至少一个 SQL 视图（例如：用于复杂的销售报表统计），并在后端调用该视图。
    - **存储过程 (Stored Procedures)**：核心的事务逻辑（如“创建订单并扣减库存”）**必须**写成 SQL 存储过程，由 Java 调用，而不是完全在 Java Service 层实现。
    - **索引 (Indexes)**：为高频查询字段（如 `car_vin`, `customer_phone`）创建索引。
3.  **数据一致性**：必须配置外键约束。

## 4. 数据库表结构设计 (概念模型)
请设计至少包含以下 4 个核心实体，符合第三范式 (3NF)：

1.  **`sys_user` (员工/管理员)**：
    - 用于登录鉴权（区分管理员和销售员）。
2.  **`car_info` (车辆库存)**：
    - 代表**唯一的实车**（一车一码）。
    - **关键字段**：`vin` (车架号，唯一), `brand`, `model`, `price`, `status` (0:在库, 1:锁定, 2:已售)。
    - *注意：不要设计成“车型+数量”的结构，要每一行代表一辆具体的车。*
3.  **`customer` (客户)**：
    - 沉淀客户档案，避免订单表中重复录入客户信息。
    - **关键字段**：`name`, `phone`, `id_card`。
4.  **`sales_order` (销售订单)**：
    - 连接 员工、客户、车辆 的纽带。
    - **关键字段**：`actual_price` (实际成交价), `order_date`, `status`。

## 5. 功能需求详情

### 第一阶段：后端开发 (Backend)
1.  **基础设施**：搭建 Spring Boot，配置全局异常处理、统一返回结果封装 (Result)、CORS 跨域配置。
2.  **基础 CRUD**：实现用户、车辆、客户的增删改查。
3.  **高级查询**：
    - 车辆查询接口需支持多条件筛选：品牌（精确匹配）、价格区间（最小值-最大值）、车辆状态。
4.  **Excel 导入导出**：
    - 实现“批量导入车辆”功能（解析 Excel 存入数据库）。
    - 实现“导出销售报表”功能。
5.  **课设逻辑陷阱 (重点)**：
    - **下单逻辑**：不要在 Java 里写 "Insert Order + Update Car Status"。
    - **要求**：编写一个 SQL 存储过程 `proc_create_order(userId, customerId, carId, price)`，在数据库层面处理事务和状态变更。Java 只负责调用。

### 第二阶段：前端开发 (Frontend)
1.  **布局架构**：经典的后台管理布局（侧边栏导航 + 顶部 Header + 内容区域）。
2.  **车辆管理页**：
    - 表格展示，使用 Tag 显示车辆状态（在库/已售）。
    - 包含“导入 Excel”和“导出”按钮。
3.  **订单管理页**：
    - 提供一个弹窗或向导：选择客户 -> 选择“在库”状态的车辆 -> 确认下单。
4.  **仪表盘 (加分项)**：
    - 首页集成 **ECharts**。
    - 调用后端的视图接口，展示“品牌销量占比”或“月度销售趋势”图表。

## 6. 执行步骤指令
请按以下逻辑分步骤思考和输出（不要一次性输出所有代码）：
1.  **Step 1 - SQL 设计**：编写完整的 openGauss SQL 脚本（包含建表 DDL、视图、存储过程、索引）。*等待我确认 SQL 无误。*
2.  **Step 2 - 后端实现**：生成 Spring Boot 项目结构、实体类（注意主键策略注解）、Mapper 和 Service 代码。
3.  **Step 3 - 前端实现**：生成 Vue 页面和 API 调用逻辑。

**行动**：请确认你已理解上述规范，并从 **Step 1 (SQL 脚本)** 开始输出。