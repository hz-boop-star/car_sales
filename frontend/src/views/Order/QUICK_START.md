# 订单管理模块 - 快速启动指南

## 访问页面

1. 启动后端服务（Spring Boot）：
   ```bash
   cd backend
   mvnw.cmd spring-boot:run
   ```

2. 启动前端服务（Vue 3）：
   ```bash
   cd frontend
   npm run dev
   ```

3. 在浏览器中访问：
   ```
   http://localhost:5173
   ```

4. 登录系统后，点击侧边栏的"订单管理"菜单项

## 功能使用

### 查看订单列表

#### 基本查看
- 页面加载后自动显示订单列表
- 默认每页显示 10 条记录
- 表格显示订单的完整信息

#### 搜索订单

1. **按日期区间搜索**：
   - 点击"订单日期"日期选择器
   - 选择开始日期和结束日期
   - 点击"查询"按钮
   - 系统会显示该日期范围内的所有订单

2. **按销售员搜索**：
   - 点击"销售员"下拉框
   - 选择特定销售员
   - 点击"查询"按钮
   - 系统会显示该销售员的所有订单

3. **按状态搜索**：
   - 点击"状态"下拉框
   - 选择"已完成"或"已取消"
   - 点击"查询"按钮
   - 系统会显示该状态的所有订单

4. **组合搜索**：
   - 可以同时使用多个搜索条件
   - 例如：查询某个销售员在某个日期范围内的已完成订单

5. **重置搜索**：
   - 点击"重置"按钮清空所有搜索条件
   - 系统会重新显示所有订单

#### 查看订单详情
1. 在订单列表中找到要查看的订单
2. 点击该行的"详情"按钮
3. 在弹出的对话框中查看完整的订单信息：
   - 订单基本信息
   - 客户信息
   - 车辆信息
   - 价格信息
   - 销售员信息
   - 备注信息

#### 分页操作
1. **切换页码**：
   - 点击页码数字直接跳转
   - 点击"上一页"/"下一页"按钮

2. **修改每页条数**：
   - 点击"10 条/页"下拉框
   - 选择 10、20、50 或 100

3. **跳转到指定页**：
   - 在"前往"输入框中输入页码
   - 按回车键跳转

### 创建订单

#### 进入创建页面
- 点击订单列表右上角的"创建订单"按钮
- 系统会跳转到订单创建向导页面

#### 步骤 1：选择客户

1. **搜索客户**：
   - 在"客户姓名"输入框中输入姓名关键字，或
   - 在"手机号"输入框中输入手机号
   - 点击"查询"按钮

2. **选择客户**：
   - 在客户列表中点击要选择的客户行
   - 被选中的行会高亮显示

3. **进入下一步**：
   - 选择客户后，"下一步"按钮会变为可用状态
   - 点击"下一步"按钮进入车辆选择

**注意**：必须选择一个客户才能进入下一步。

#### 步骤 2：选择车辆

1. **查看可售车辆**：
   - 系统自动显示所有"在库"状态的车辆
   - 只有这些车辆可以被销售

2. **搜索车辆**（可选）：
   - 在"品牌"输入框中输入品牌名称
   - 点击"查询"按钮筛选

3. **选择车辆**：
   - 在车辆列表中点击要选择的车辆行
   - 被选中的行会高亮显示
   - 可以看到车辆的详细信息（VIN码、品牌、型号、颜色、年份、价格）

4. **进入下一步**：
   - 选择车辆后，"下一步"按钮会变为可用状态
   - 点击"下一步"按钮进入订单确认

**注意**：
- 必须选择一个车辆才能进入下一步
- 只能选择"在库"状态的车辆
- 如果车辆已被其他订单占用，创建会失败

#### 步骤 3：确认订单

1. **查看信息**：
   - 客户信息（姓名、手机号）- 只读
   - 车辆信息（品牌、型号、VIN码、原价）- 只读

2. **填写订单信息**：
   - **优惠金额**（必填）：
     - 输入优惠金额（0 到车辆原价之间）
     - 系统会自动计算成交价
     - 成交价 = 原价 - 优惠金额
   
   - **订单日期**（必填）：
     - 默认为当天日期
     - 可以点击日期选择器修改
   
   - **备注**（可选）：
     - 输入订单备注信息
     - 例如：客户特殊要求、付款方式等

3. **提交订单**：
   - 确认所有信息无误后，点击"提交订单"按钮
   - 系统会显示提交中的加载状态
   - 提交成功后：
     - 显示成功消息
     - 自动跳转到订单列表页面
     - 可以在列表中看到刚创建的订单
   - 提交失败后：
     - 显示错误消息
     - 保持在当前页面，可以修改后重新提交

4. **其他操作**：
   - **上一步**：返回车辆选择页面
   - **取消**：放弃创建，返回订单列表

#### 订单创建后的变化

订单创建成功后，系统会自动：
1. 生成唯一的订单号
2. 将车辆状态从"在库"更新为"已售"
3. 记录销售员信息（当前登录用户）
4. 计算优惠金额（原价 - 成交价）
5. 设置订单状态为"已完成"

## 常见问题

### Q1: 为什么搜索不到订单？
A: 请检查：
- 日期范围是否正确
- 销售员是否选择正确
- 状态筛选是否正确
- 是否点击了"查询"按钮

### Q2: 为什么无法创建订单？
A: 可能的原因：
- 没有选择客户或车辆
- 优惠金额超过了车辆原价
- 优惠金额为负数
- 订单日期未填写
- 选择的车辆已被其他订单占用（不是"在库"状态）
- 网络连接问题

### Q3: 为什么看不到某些车辆？
A: 订单创建时只显示"在库"状态的车辆。如果车辆已被销售或锁定，将不会出现在列表中。

### Q4: 优惠金额如何计算？
A: 
- 优惠金额 = 原价 - 成交价
- 例如：车辆原价 100,000 元，成交价 95,000 元，优惠金额 = 5,000 元
- 系统会自动计算成交价，您只需输入优惠金额

### Q5: 订单创建后可以修改吗？
A: 当前版本不支持订单修改。订单创建后：
- 订单信息不可修改
- 车辆状态已更新为"已售"，不可恢复
- 如需修改，请联系管理员

### Q6: 如何查看我的销售业绩？
A: 
1. 在订单列表页面
2. 点击"销售员"下拉框
3. 选择您的姓名
4. 点击"查询"按钮
5. 系统会显示您的所有订单

### Q7: 并发创建订单会有问题吗？
A: 不会。系统使用数据库存储过程和行锁机制防止并发问题：
- 如果两个用户同时尝试购买同一辆车
- 只有一个用户会成功
- 另一个用户会收到错误提示

## 技术支持

如有问题，请联系开发团队或查看以下文档：
- 功能文档：`README.md`
- 验证清单：`VERIFICATION.md`
- 完成总结：`TASK_19_COMPLETION_SUMMARY.md`

## 注意事项

1. **车辆状态**：
   - 订单创建后，车辆状态会立即变为"已售"
   - 该车辆将不再出现在可售车辆列表中
   - 操作不可撤销

2. **数据一致性**：
   - 订单创建和车辆状态更新在同一事务中
   - 任何失败都会回滚整个操作
   - 确保数据完整性

3. **权限控制**：
   - 所有用户都可以查看订单列表
   - 所有用户都可以创建订单
   - 订单会自动关联到当前登录用户

4. **性能优化**：
   - 订单列表支持分页，避免一次加载过多数据
   - 搜索功能在后端执行，提高查询效率
   - 车辆列表限制为 100 条，避免加载过多数据
